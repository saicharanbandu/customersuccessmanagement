{% extends "base.html" %}

{% load static %}

{% block head_title %}{{ title }}{% endblock %}

{% block navbar %}
{% include '_partials/_navbar.html' %}
{% endblock %}

{% block sidebar %}
{% include '_partials/_sidebar.html' %}
{% endblock %}

{% block page_title %}
<span class="page-title-icon bg-gradient-primary text-white me-2">
  <i class="mdi mdi-bullseye"></i>
</span>
{{ title }}
{% endblock %}

{% block app_scripts %}
<script src="{% static 'prospect/js/app.js' %}"></script>
{% endblock %}

{% block content %}
<div class="row">
  <div class="col-lg-12 grid-margin stretch-card">
    <div class="card">
      <div class="card-body">
        <div class="row">
          <div class="col-8 col-lg-6">
            <form method="GET">
              <div class="input-group">
                <input type="search" class="form-control" placeholder="Search" name="search"
                  value="{{ request.GET.search }}">
                <button type="submit" class="btn btn-sm btn-light">
                  <i class="mdi mdi-magnify"></i>
                </button>
              </div>
            </form>
          </div>
          <div class="col-4 col-lg-6">
            <a href="{% url 'prospect:create' %}" class="btn btn-gradient-primary float-end">
              <i class="mdi mdi-plus me-2"></i>
              New Prospect
            </a>
          </div>
        </div>
        <table class="table table-hover mt-3">
          <thead>
            <tr>
              <th class="sl-col">#</th>
              <th class="name-col">NAME</th>
              <th>CONTACT PERSONS</th>
              <th class="status-col">STATUS</th>
              <th>CRM</th>
              <th class="remarks-col">REMARKS</th>
              <th class="actions-col">ACTIONS</th>
            </tr>
          </thead>
          <tbody>
            {% for prospect in prospects %}
            <tr>
              <td class="sl-col">{{ forloop.counter0 | add:page_obj.start_index }}</td>
              <td>
                <div class="name-group">
                  <a class="action-link view-action" data-bs-toggle="modal" data-bs-target="#viewModal" data-url="{% url 'prospect:get-prospect-info' prospect.uuid %}">{{ prospect.name }}</a>
                  <div class="description">
                    {{ prospect.address }}, {{ prospect.city }}, <br>{{ prospect.state }} {{ prospect.country }}
                  </div>
                </div>
              </td>
              <td>
                {% for contact in prospect.prospect_poc.all %}
                <div class="contact-group">
                  {{ contact.name }}
                  {% if contact.remarks %}
                  <a data-bs-toggle="tooltip" data-bs-placement="top" href="" title="{{ contact.remarks }}">
                    <i class="mdi mdi-information-outline"></i>
                  </a>
                  {% endif %}
                  <div class="contact-details-sm">
                    <div>
                      <i class="mdi mdi-email-outline"></i>
                      {{ contact.email | default_if_none:"--" }}
                    </div>
                    <div>
                      <i class="mdi mdi-cellphone-android"></i>
                      {{ contact.mobile | default_if_none:"--" }}
                    </div>
                  </div>
                </div>
                {% if not forloop.last %}
                <hr>
                {% endif %}
                {% endfor %}
              </td>
              <td class="status-col">
                {% if prospect.status %}
                <label class="badge status-{{ prospect.status }} text-capitalize">{{ prospect.status }}</label>
                {% else %}
                --
                {% endif %}
              </td>
              <td><span class="text-faded">{{ prospect.manager.full_name }}</span></td>
              <td class="remarks-col">
                {% if prospect.remarks %}
                <a class="action-link view-action" data-bs-toggle="modal" data-bs-target="#viewModal" data-url="{% url 'prospect:get-prospect-remarks' prospect.uuid %}">
                  <i class="mdi mdi-information-outline fs-4"></i>
                </a>
                {% endif %}
              </td>
              <td class="actions-col">
                <div class="dropdown">
                  <button class="btn p-0" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                    <i class="mdi mdi-dots-vertical"></i>
                  </button>
                  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <a class="dropdown-item" href="{% url 'prospect:edit' prospect.uuid %}">
                      <i class="mdi mdi-pencil-box-outline me-2"></i>
                      Edit Prospect Info
                  </a>
                  <a class="dropdown-item" href="{% url 'prospect:update_poc' prospect.uuid %}">
                    
                      <i class="mdi mdi mdi-contacts me-2"></i>
                      Update Contacts Persons
                    </a>
                    <a class="dropdown-item prospect-action" data-bs-toggle="modal" data-bs-target="#updateModal"
                      data-url="{% url "prospect:update-remarks-ajax" prospect.uuid %}">
                      <i class="mdi mdi-information-outline me-2"></i>
                      Update Remarks
                    </a>
                    <a class="dropdown-item prospect-action" data-bs-toggle="modal" data-bs-target="#updateModal"
                      data-url="{% url "prospect:update-crm-ajax" prospect.uuid %}">
                      <i class="mdi mdi-account-convert me-2"></i>
                      Re-assign CRM
                    </a>

                    <a class="dropdown-item border-top status-action" data-bs-toggle="modal"
                      data-bs-target="#updateModal" data-url="{% url "prospect:update-status-ajax" prospect.uuid %}">
                      <i class="mdi mdi-refresh me-2"></i>
                      Change Status
                    </a>
                  </div>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% include '_partials/_pagination.html' %}
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="updateModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
    </div>
  </div>
</div>

<div class="modal fade" id="viewModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
    </div>
  </div>
</div>
{% endblock %}